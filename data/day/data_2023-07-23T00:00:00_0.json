{
    "data": {
        "search": {
            "edges": [
                {
                    "node": {
                        "number": 158,
                        "title": "FlatAHB Dump: Don't use new GUID for otherwise unchanged lines",
                        "repository": {
                            "nameWithOwner": "Hochfrequenz/kohlrahbi",
                            "primaryLanguage": {
                                "name": "Python"
                            }
                        },
                        "createdAt": "2023-07-23T09:56:12Z",
                        "mergedAt": "2023-07-24T10:02:26Z",
                        "url": "https://github.com/Hochfrequenz/kohlrahbi/pull/158",
                        "state": "MERGED",
                        "author": {
                            "login": "hf-kklein"
                        },
                        "editor": null,
                        "body": "This should reduce the technical noise e.g. in https://github.com/Hochfrequenz/machine-readable_anwendungshandbuecher/commit/ae8cfe6001193e79fe80295dd60c4a385c873845\n",
                        "comments": {
                            "nodes": []
                        },
                        "reviews": {
                            "edges": [
                                {
                                    "node": {
                                        "state": "COMMENTED",
                                        "bodyText": "",
                                        "comments": {
                                            "edges": [
                                                {
                                                    "node": {
                                                        "bodyText": "when do we need this part?",
                                                        "author": {
                                                            "login": "hf-krechan"
                                                        },
                                                        "url": "https://github.com/Hochfrequenz/kohlrahbi/pull/158#discussion_r1271802809",
                                                        "originalCommit": {
                                                            "abbreviatedOid": "72a9a33",
                                                            "authoredDate": "2023-07-23T09:55:55Z"
                                                        }
                                                    }
                                                }
                                            ]
                                        }
                                    }
                                },
                                {
                                    "node": {
                                        "state": "COMMENTED",
                                        "bodyText": "",
                                        "comments": {
                                            "edges": [
                                                {
                                                    "node": {
                                                        "bodyText": "an dieser stelle",
                                                        "author": {
                                                            "login": "hf-kklein"
                                                        },
                                                        "url": "https://github.com/Hochfrequenz/kohlrahbi/pull/158#discussion_r1271812201",
                                                        "originalCommit": {
                                                            "abbreviatedOid": "72a9a33",
                                                            "authoredDate": "2023-07-23T09:55:55Z"
                                                        }
                                                    }
                                                }
                                            ]
                                        }
                                    }
                                },
                                {
                                    "node": {
                                        "state": "COMMENTED",
                                        "bodyText": "",
                                        "comments": {
                                            "edges": [
                                                {
                                                    "node": {
                                                        "bodyText": "https://github.com/Hochfrequenz/kohlrahbi/pull/158/files#r1271812201",
                                                        "author": {
                                                            "login": "hf-kklein"
                                                        },
                                                        "url": "https://github.com/Hochfrequenz/kohlrahbi/pull/158#discussion_r1271812261",
                                                        "originalCommit": {
                                                            "abbreviatedOid": "72a9a33",
                                                            "authoredDate": "2023-07-23T09:55:55Z"
                                                        }
                                                    }
                                                }
                                            ]
                                        }
                                    }
                                },
                                {
                                    "node": {
                                        "state": "COMMENTED",
                                        "bodyText": "",
                                        "comments": {
                                            "edges": [
                                                {
                                                    "node": {
                                                        "bodyText": "dump_equals_existing_file_except_for_guids I think we can improve this name.\nIt is not so clear at the first reading.\nCan you explain what this variable controls?",
                                                        "author": {
                                                            "login": "hf-krechan"
                                                        },
                                                        "url": "https://github.com/Hochfrequenz/kohlrahbi/pull/158#discussion_r1271843333",
                                                        "originalCommit": {
                                                            "abbreviatedOid": "72a9a33",
                                                            "authoredDate": "2023-07-23T09:55:55Z"
                                                        }
                                                    }
                                                }
                                            ]
                                        }
                                    }
                                },
                                {
                                    "node": {
                                        "state": "COMMENTED",
                                        "bodyText": "",
                                        "comments": {
                                            "edges": [
                                                {
                                                    "node": {
                                                        "bodyText": "This is the same condition like in line 299. Is this by design?",
                                                        "author": {
                                                            "login": "hf-krechan"
                                                        },
                                                        "url": "https://github.com/Hochfrequenz/kohlrahbi/pull/158#discussion_r1271843648",
                                                        "originalCommit": {
                                                            "abbreviatedOid": "72a9a33",
                                                            "authoredDate": "2023-07-23T09:55:55Z"
                                                        }
                                                    }
                                                }
                                            ]
                                        }
                                    }
                                },
                                {
                                    "node": {
                                        "state": "COMMENTED",
                                        "bodyText": "",
                                        "comments": {
                                            "edges": [
                                                {
                                                    "node": {
                                                        "bodyText": "This is a C# pattern for deep copies isn't it?\nI thought in Python there are methods to create deep copies.\n*asking chatGPT*\nah yes there is a standard lib called copy\nSee https://chat.openai.com/share/4ad4c1ad-6f13-4a21-a0e3-aaf75e17c556",
                                                        "author": {
                                                            "login": "hf-krechan"
                                                        },
                                                        "url": "https://github.com/Hochfrequenz/kohlrahbi/pull/158#discussion_r1271847864",
                                                        "originalCommit": {
                                                            "abbreviatedOid": "72a9a33",
                                                            "authoredDate": "2023-07-23T09:55:55Z"
                                                        }
                                                    }
                                                }
                                            ]
                                        }
                                    }
                                },
                                {
                                    "node": {
                                        "state": "COMMENTED",
                                        "bodyText": "",
                                        "comments": {
                                            "edges": [
                                                {
                                                    "node": {
                                                        "bodyText": "uh nice. great that the AhbLine class supports is_equal out of the box :)",
                                                        "author": {
                                                            "login": "hf-krechan"
                                                        },
                                                        "url": "https://github.com/Hochfrequenz/kohlrahbi/pull/158#discussion_r1272016522",
                                                        "originalCommit": {
                                                            "abbreviatedOid": "58064f9",
                                                            "authoredDate": "2023-07-24T09:26:55Z"
                                                        }
                                                    }
                                                }
                                            ]
                                        }
                                    }
                                },
                                {
                                    "node": {
                                        "state": "APPROVED",
                                        "bodyText": "Sweet I like it :)",
                                        "comments": {
                                            "edges": []
                                        }
                                    }
                                },
                                {
                                    "node": {
                                        "state": "COMMENTED",
                                        "bodyText": "",
                                        "comments": {
                                            "edges": [
                                                {
                                                    "node": {
                                                        "bodyText": "well, that's one purpose of attrs, pydantic, dataclasses and alike",
                                                        "author": {
                                                            "login": "hf-kklein"
                                                        },
                                                        "url": "https://github.com/Hochfrequenz/kohlrahbi/pull/158#discussion_r1272031817",
                                                        "originalCommit": {
                                                            "abbreviatedOid": "58064f9",
                                                            "authoredDate": "2023-07-24T09:26:55Z"
                                                        }
                                                    }
                                                }
                                            ]
                                        }
                                    }
                                }
                            ]
                        }
                    },
                    "textMatches": [
                        {
                            "property": "comments.body"
                        },
                        {
                            "property": "body"
                        }
                    ]
                },
                {
                    "node": {
                        "number": 241,
                        "title": "build: disable internet access during the build step",
                        "repository": {
                            "nameWithOwner": "autowarefoundation/autoware-github-actions",
                            "primaryLanguage": {
                                "name": "Python"
                            }
                        },
                        "createdAt": "2023-07-23T18:59:26Z",
                        "mergedAt": "2023-09-20T10:01:22Z",
                        "url": "https://github.com/autowarefoundation/autoware-github-actions/pull/241",
                        "state": "MERGED",
                        "author": {
                            "login": "esteve"
                        },
                        "editor": {
                            "login": "esteve"
                        },
                        "body": "## Description\r\n\r\n<!-- Write a brief description of this PR. -->\r\nThis PR disables access to internet so that we make sure that packages do not download any artifacts during the build step.\r\n\r\n## Tests performed\r\n\r\n<!-- Describe how you have tested this PR. -->\r\n<!-- Although the default value is set to \"Not Applicable.\", please update this section if the type is either [feat, fix, perf], or if requested by the reviewers. -->\r\n\r\nNot applicable.\r\n\r\n## Effects on system behavior\r\n\r\n<!-- Describe how this PR affects the system behavior. -->\r\n\r\nNot applicable.\r\n\r\n## Pre-review checklist for the PR author\r\n\r\nThe PR author **must** check the checkboxes below when creating the PR.\r\n\r\n- [x] I've confirmed the [contribution guidelines].\r\n- [x] The PR follows the [pull request guidelines].\r\n\r\n## In-review checklist for the PR reviewers\r\n\r\nThe PR reviewers **must** check the checkboxes below before approval.\r\n\r\n- [x] The PR follows the [pull request guidelines].\r\n\r\n## Post-review checklist for the PR author\r\n\r\nThe PR author **must** check the checkboxes below before merging.\r\n\r\n- [ ] There are no open discussions or they are tracked via tickets.\r\n\r\nAfter all checkboxes are checked, anyone who has write access can merge the PR.\r\n\r\n[contribution guidelines]: https://autowarefoundation.github.io/autoware-documentation/main/contributing/\r\n[pull request guidelines]: https://autowarefoundation.github.io/autoware-documentation/main/contributing/pull-request-guidelines/\r\n",
                        "comments": {
                            "nodes": [
                                {
                                    "createdAt": "2023-07-25T10:46:56Z",
                                    "bodyText": "@mitsudome-r @xmfcx I don't know who should be assigned as a reviewer for this PR. The spell check test is failing because it's waiting for tier4/autoware-spell-check-dict#585",
                                    "url": "https://github.com/autowarefoundation/autoware-github-actions/pull/241#issuecomment-1649599084",
                                    "author": {
                                        "login": "esteve"
                                    }
                                },
                                {
                                    "createdAt": "2023-08-31T01:32:24Z",
                                    "bodyText": "@esteve\nsorry for late response.\nThe changes seem to be fine to me, but I am testing them just to be sure.\nhttps://github.com/HansRobo/autoware.universe/actions/runs/6031849665\nPlease wait for a while",
                                    "url": "https://github.com/autowarefoundation/autoware-github-actions/pull/241#issuecomment-1700198198",
                                    "author": {
                                        "login": "HansRobo"
                                    }
                                },
                                {
                                    "createdAt": "2023-08-31T05:46:40Z",
                                    "bodyText": "It seems that there are still packages in A that require external access during build.\nref: tensorrt_yolo tries to download a file via internet and its build fails\n@esteve\nHow about extracting to the step of /etc/nsswitch.conf setting change and setting restoration workflow and adding an argument of colcon-build action that controls whether it can be executed or not, so as not to be a destructive change? (e.g. allow_internet_acess_during_building)",
                                    "url": "https://github.com/autowarefoundation/autoware-github-actions/pull/241#issuecomment-1700403150",
                                    "author": {
                                        "login": "HansRobo"
                                    }
                                },
                                {
                                    "createdAt": "2023-08-31T09:23:44Z",
                                    "bodyText": "@HansRobo thanks for your review. I prefer not to add the option to disable this check, otherwise I worry that developers will bypass it and we won't notice (we don't have similar options for any of the other required checks). In any case, this PR is not meant to be merged as is right now, but once all the packages have been patched to not download artifacts by default (like tensorrt_yolo, for example), this PR can be merged and ensure that future packages don't access the network. The patch for tensorrt_yolo can be found at autowarefoundation/autoware.universe#3142, I'm tracking all the packages that need patching in autowarefoundation/autoware.universe#3137\nI created a test PR (see autowarefoundation/autoware.universe#4375) to demonstrate how a PR that accesses the network would fail.",
                                    "url": "https://github.com/autowarefoundation/autoware-github-actions/pull/241#issuecomment-1700680333",
                                    "author": {
                                        "login": "esteve"
                                    }
                                },
                                {
                                    "createdAt": "2023-09-01T08:31:59Z",
                                    "bodyText": "@esteve\nI see. Thank you for providing the situation about this pull-request!\nIt's ok to merge this pull-request after finishing autowarefoundation/autoware.universe#3142 and autowarefoundation/autoware.universe#3137.\nSo, please don't mind my advice to add an option to allow internet connection.\nCould you please let me know, when everything is complete?\nLet's merge this pull-request then!",
                                    "url": "https://github.com/autowarefoundation/autoware-github-actions/pull/241#issuecomment-1702374720",
                                    "author": {
                                        "login": "HansRobo"
                                    }
                                },
                                {
                                    "createdAt": "2023-09-19T14:02:02Z",
                                    "bodyText": "@HansRobo we have merged autowarefoundation/autoware#3375 and will merge autowarefoundation/autoware-documentation#345 soon. In the mean time between autowarefoundation/autoware#3375 was submitted and it was merged, autowarefoundation/autoware.universe#3143 has conflicts because new artifacts were added, so I propose we merge this PR as soon as possible to avoid new artifacts being added to packages.\n@xmfcx @lexavtanke what do you think about merging this as soon as possible?",
                                    "url": "https://github.com/autowarefoundation/autoware-github-actions/pull/241#issuecomment-1725655157",
                                    "author": {
                                        "login": "esteve"
                                    }
                                },
                                {
                                    "createdAt": "2023-09-19T14:49:10Z",
                                    "bodyText": "@HansRobo @mitsudome-r @kminoda is this repository being utilized by some internal TIER IV repositories?\nDo any of those repositories download during the colcon build process?\nIf not I would like to merge this.",
                                    "url": "https://github.com/autowarefoundation/autoware-github-actions/pull/241#issuecomment-1725797458",
                                    "author": {
                                        "login": "xmfcx"
                                    }
                                },
                                {
                                    "createdAt": "2023-09-19T14:51:27Z",
                                    "bodyText": "@xmfcx tensorrt_yolox currently downloads from the internet, but the list of artifacts has been updated since we first submitted autowarefoundation/autoware#3375, so I had to submit autowarefoundation/autoware#3848 to update the ansible scripts",
                                    "url": "https://github.com/autowarefoundation/autoware-github-actions/pull/241#issuecomment-1725801870",
                                    "author": {
                                        "login": "esteve"
                                    }
                                },
                                {
                                    "createdAt": "2023-09-19T15:02:03Z",
                                    "bodyText": "Also I've asked ChatGPT for a solution to see if there are any other way of doing it and it recommended following:\nhttps://chat.openai.com/share/10110835-5bbc-48b0-91b3-299c62290fcf\n   - name: Disable Internet (DNS method)\n     run: echo \"nameserver 0.0.0.0\" | sudo tee /etc/resolv.conf\n     shell: bash\n\n   - name: Build\n     run: |\n       colcon build --event-handlers console_cohesion+ \\\n         --packages-above-and-dependencies ${{ inputs.target-packages }} \\\n         --cmake-args -DCMAKE_BUILD_TYPE=${{ inputs.cmake-build-type }} \\\n         --mixin coverage-gcc coverage-pytest compile-commands\n     shell: bash\n\n   - name: Restore Internet (DNS method)\n     if: always()\n     run: |\n       echo \"nameserver 8.8.8.8\" | sudo tee /etc/resolv.conf\n     shell: bash\n\nI didn't try it but separating the disable internet and restore internet into separate items might make it more readable. I'm not aware of further implications of this change, please just treat it as a suggestion.",
                                    "url": "https://github.com/autowarefoundation/autoware-github-actions/pull/241#issuecomment-1725823086",
                                    "author": {
                                        "login": "xmfcx"
                                    }
                                },
                                {
                                    "createdAt": "2023-09-19T15:07:01Z",
                                    "bodyText": "@xmfcx I prefer using the nsswitch method because we make sure that even if /etc/resolv.conf gets updated (e.g. via dhcp), we won't be using it",
                                    "url": "https://github.com/autowarefoundation/autoware-github-actions/pull/241#issuecomment-1725835247",
                                    "author": {
                                        "login": "esteve"
                                    }
                                },
                                {
                                    "createdAt": "2023-09-19T15:17:06Z",
                                    "bodyText": "@esteve I see. What do you think about separating \"disable internet\" and \"restore internet\" into new steps?",
                                    "url": "https://github.com/autowarefoundation/autoware-github-actions/pull/241#issuecomment-1725871865",
                                    "author": {
                                        "login": "xmfcx"
                                    }
                                },
                                {
                                    "createdAt": "2023-09-19T15:18:33Z",
                                    "bodyText": "@xmfcx I don't think it's needed, because if colcon build fails, none of the other steps will run",
                                    "url": "https://github.com/autowarefoundation/autoware-github-actions/pull/241#issuecomment-1725874520",
                                    "author": {
                                        "login": "esteve"
                                    }
                                },
                                {
                                    "createdAt": "2023-09-20T10:36:44Z",
                                    "bodyText": "@xmfcx thanks!",
                                    "url": "https://github.com/autowarefoundation/autoware-github-actions/pull/241#issuecomment-1727462460",
                                    "author": {
                                        "login": "esteve"
                                    }
                                }
                            ]
                        },
                        "reviews": {
                            "edges": [
                                {
                                    "node": {
                                        "state": "APPROVED",
                                        "bodyText": "I approve this to prevent additional changes being made which downloads artifacts during build process. Any repo will need to update their action version anyways to have these applied anyways.",
                                        "comments": {
                                            "edges": []
                                        }
                                    }
                                }
                            ]
                        }
                    },
                    "textMatches": [
                        {
                            "property": "comments.body"
                        }
                    ]
                },
                {
                    "node": {
                        "number": 84,
                        "title": "Fix #74: Correct for Lens Distortion for ray angle calculation",
                        "repository": {
                            "nameWithOwner": "Theta-Limited/OpenAthenaAndroid",
                            "primaryLanguage": {
                                "name": "Java"
                            }
                        },
                        "createdAt": "2023-07-23T19:43:33Z",
                        "mergedAt": null,
                        "url": "https://github.com/Theta-Limited/OpenAthenaAndroid/pull/84",
                        "state": "CLOSED",
                        "author": {
                            "login": "mkrupczak3"
                        },
                        "editor": {
                            "login": "mkrupczak3"
                        },
                        "body": "[![AutoPR Failure](https://img.shields.io/badge/AutoPR-failure-red)](https://github.com/Theta-Limited/OpenAthenaAndroid/actions/runs/5638284130)\n\nFixes #74\n\n## Status\n\nThis pull request was being autonomously generated by [AutoPR](https://github.com/irgolic/AutoPR), but it encountered an error.\n\nError:\n\n```\nTraceback (most recent call last):\n  File \"/app/autopr/services/action_service.py\", line 186, in run_action\n    results = action.run(arguments, context)\n  File \"/app/autopr/actions/look_at_files.py\", line 375, in run\n    filepaths = self.get_initial_filepaths(files, context)\n  File \"/app/autopr/actions/look_at_files.py\", line 276, in get_initial_filepaths\n    response = self.rail_service.run_prompt_rail(\n  File \"/app/autopr/services/rail_service.py\", line 355, in run_prompt_rail\n    prompt = self.completions_repo.complete(\n  File \"/app/autopr/repos/completions_repo.py\", line 84, in complete\n    raise e\n  File \"/app/autopr/repos/completions_repo.py\", line 65, in complete\n    result = self._complete(\n  File \"/venv/lib/python3.9/site-packages/tenacity/__init__.py\", line 289, in wrapped_f\n    return self(f, *args, **kw)\n  File \"/venv/lib/python3.9/site-packages/tenacity/__init__.py\", line 379, in __call__\n    do = self.iter(retry_state=retry_state)\n  File \"/venv/lib/python3.9/site-packages/tenacity/__init__.py\", line 314, in iter\n    return fut.result()\n  File \"/usr/local/lib/python3.9/concurrent/futures/_base.py\", line 439, in result\n    return self.__get_result()\n  File \"/usr/local/lib/python3.9/concurrent/futures/_base.py\", line 391, in __get_result\n    raise self._exception\n  File \"/venv/lib/python3.9/site-packages/tenacity/__init__.py\", line 382, in __call__\n    result = fn(*args, **kwargs)\n  File \"/app/autopr/repos/completions_repo.py\", line 142, in _complete\n    openai_response = openai.ChatCompletion.create(\n  File \"/venv/lib/python3.9/site-packages/openai/api_resources/chat_completion.py\", line 25, in create\n    return super().create(*args, **kwargs)\n  File \"/venv/lib/python3.9/site-packages/openai/api_resources/abstract/engine_api_resource.py\", line 153, in create\n    response, _, api_key = requestor.request(\n  File \"/venv/lib/python3.9/site-packages/openai/api_requestor.py\", line 230, in request\n    resp, got_stream = self._interpret_response(result, stream)\n  File \"/venv/lib/python3.9/site-packages/openai/api_requestor.py\", line 624, in _interpret_response\n    self._interpret_response_line(\n  File \"/venv/lib/python3.9/site-packages/openai/api_requestor.py\", line 687, in _interpret_response_line\n    raise self.handle_error_response(\nopenai.error.InvalidRequestError: The model `gpt-4` does not exist or you do not have access to it. Learn more: https://help.openai.com/en/articles/7102672-how-can-i-access-gpt-4.\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/app/autopr/services/agent_service.py\", line 78, in run_agent\n    agent.handle_event(event)\n  File \"/app/autopr/agents/plan_and_code.py\", line 216, in handle_event\n    self.create_pull_request(event)\n  File \"/app/autopr/agents/plan_and_code.py\", line 176, in create_pull_request\n    context = self.action_service.run_actions_iteratively(\n  File \"/app/autopr/services/action_service.py\", line 215, in run_actions_iteratively\n    context = self.run_action(action_id, context)\n  File \"/app/autopr/services/action_service.py\", line 195, in run_action\n    self.publish_service.end_section(f\"\u274c Failed {action_id}\")\n  File \"/app/autopr/services/publish_service.py\", line 237, in end_section\n    raise ValueError(\"Cannot end root section\")\nValueError: Cannot end root section\n\n```\n\nPlease <a href=\"https://github.com/irgolic/AutoPR/issues/new?title=ValueError:%20Cannot%20end%20root%20section&labels=bug&body=%0A[![AutoPR%20Failure](https://img.shields.io/badge/AutoPR-failure-red)](https://github.com/Theta-Limited/OpenAthenaAndroid/actions/runs/5638284130)%0A%0AAutoPR%20encountered%20an%20error.%20%20%0AIssue:%20https://github.com/Theta-Limited/OpenAthenaAndroid/issues/74%20%20%0APull%20Request:%20https://github.com/Theta-Limited/OpenAthenaAndroid/pull/84%0A%0A%0A%23%23%20Traceback%0A%0A```%0ATraceback%20(most%20recent%20call%20last):%0A%20%20File%20%22/app/autopr/services/action_service.py%22,%20line%20186,%20in%20run_action%0A%20%20%20%20results%20=%20action.run(arguments,%20context)%0A%20%20File%20%22/app/autopr/actions/look_at_files.py%22,%20line%20375,%20in%20run%0A%20%20%20%20filepaths%20=%20self.get_initial_filepaths(files,%20context)%0A%20%20File%20%22/app/autopr/actions/look_at_files.py%22,%20line%20276,%20in%20get_initial_filepaths%0A%20%20%20%20response%20=%20self.rail_service.run_prompt_rail(%0A%20%20File%20%22/app/autopr/services/rail_service.py%22,%20line%20355,%20in%20run_prompt_rail%0A%20%20%20%20prompt%20=%20self.completions_repo.complete(%0A%20%20File%20%22/app/autopr/repos/completions_repo.py%22,%20line%2084,%20in%20complete%0A%20%20%20%20raise%20e%0A%20%20File%20%22/app/autopr/repos/completions_repo.py%22,%20line%2065,%20in%20complete%0A%20%20%20%20result%20=%20self._complete(%0A%20%20File%20%22/venv/lib/python3.9/site-packages/tenacity/__init__.py%22,%20line%20289,%20in%20wrapped_f%0A%20%20%20%20return%20self(f,%20*args,%20**kw)%0A%20%20File%20%22/venv/lib/python3.9/site-packages/tenacity/__init__.py%22,%20line%20379,%20in%20__call__%0A%20%20%20%20do%20=%20self.iter(retry_state=retry_state)%0A%20%20File%20%22/venv/lib/python3.9/site-packages/tenacity/__init__.py%22,%20line%20314,%20in%20iter%0A%20%20%20%20return%20fut.result()%0A%20%20File%20%22/usr/local/lib/python3.9/concurrent/futures/_base.py%22,%20line%20439,%20in%20result%0A%20%20%20%20return%20self.__get_result()%0A%20%20File%20%22/usr/local/lib/python3.9/concurrent/futures/_base.py%22,%20line%20391,%20in%20__get_result%0A%20%20%20%20raise%20self._exception%0A%20%20File%20%22/venv/lib/python3.9/site-packages/tenacity/__init__.py%22,%20line%20382,%20in%20__call__%0A%20%20%20%20result%20=%20fn(*args,%20**kwargs)%0A%20%20File%20%22/app/autopr/repos/completions_repo.py%22,%20line%20142,%20in%20_complete%0A%20%20%20%20openai_response%20=%20openai.ChatCompletion.create(%0A%20%20File%20%22/venv/lib/python3.9/site-packages/openai/api_resources/chat_completion.py%22,%20line%2025,%20in%20create%0A%20%20%20%20return%20super().create(*args,%20**kwargs)%0A%20%20File%20%22/venv/lib/python3.9/site-packages/openai/api_resources/abstract/engine_api_resource.py%22,%20line%20153,%20in%20create%0A%20%20%20%20response,%20_,%20api_key%20=%20requestor.request(%0A%20%20File%20%22/venv/lib/python3.9/site-packages/openai/api_requestor.py%22,%20line%20230,%20in%20request%0A%20%20%20%20resp,%20got_stream%20=%20self._interpret_response(result,%20stream)%0A%20%20File%20%22/venv/lib/python3.9/site-packages/openai/api_requestor.py%22,%20line%20624,%20in%20_interpret_response%0A%20%20%20%20self._interpret_response_line(%0A%20%20File%20%22/venv/lib/python3.9/site-packages/openai/api_requestor.py%22,%20line%20687,%20in%20_interpret_response_line%0A%20%20%20%20raise%20self.handle_error_response(%0Aopenai.error.InvalidRequestError:%20The%20model%20`gpt-4`%20does%20not%20exist%20or%20you%20do%20not%20have%20access%20to%20it.%20Learn%20more:%20https://help.openai.com/en/articles/7102672-how-can-i-access-gpt-4.%0A%0ADuring%20handling%20of%20the%20above%20exception,%20another%20exception%20occurred:%0A%0ATraceback%20(most%20recent%20call%20last):%0A%20%20File%20%22/app/autopr/services/agent_service.py%22,%20line%2078,%20in%20run_agent%0A%20%20%20%20agent.handle_event(event)%0A%20%20File%20%22/app/autopr/agents/plan_and_code.py%22,%20line%20216,%20in%20handle_event%0A%20%20%20%20self.create_pull_request(event)%0A%20%20File%20%22/app/autopr/agents/plan_and_code.py%22,%20line%20176,%20in%20create_pull_request%0A%20%20%20%20context%20=%20self.action_service.run_actions_iteratively(%0A%20%20File%20%22/app/autopr/services/action_service.py%22,%20line%20215,%20in%20run_actions_iteratively%0A%20%20%20%20context%20=%20self.run_action(action_id,%20context)%0A%20%20File%20%22/app/autopr/services/action_service.py%22,%20line%20195,%20in%20run_action%0A%20%20%20%20self.publish_service.end_section(f%22\u274c%20Failed%20{action_id}%22)%0A%20%20File%20%22/app/autopr/services/publish_service.py%22,%20line%20237,%20in%20end_section%0A%20%20%20%20raise%20ValueError(%22Cannot%20end%20root%20section%22)%0AValueError:%20Cannot%20end%20root%20section%0A%0A```%0A\">open an issue</a> to report this.\n\n<details>\n<summary>\ud83d\udcd6 Looking at files</summary>\n\n> <details open>\n> <summary>\ud83d\udcac Asking for InitialFileSelect</summary>\n> \n> > <details open>\n> > <summary>Prompt</summary>\n> > \n> > ~~~\n> > Hey, somebody just opened an issue in my repo, could you help me write a pull request?\n> > \n> > Given context variables enclosed by +-+:\n> > \n> > Issue:\n> > +-+\n> > #74 Correct for Lens Distortion for ray angle calculation\n> > \n> > mkrupczak3: Our current calculation for ray angle from a selected image point is entirely based on the idealized [pinhole camera model](https://towardsdatascience.com/camera-intrinsic-matrix-with-example-in-python-d79bf2478c12?gi=8bd7b436d2d3). This makes no consideration of the properties of the actual camera lens, which introduces its own image distortion subtly different than may be expected in the pinhole camera model. These distortions may be especially pronounced with fisheye cameras or zoom lenses at larger focal lengths:\n> > https://en.wikipedia.org/wiki/Distortion_(optics)\n> > \n> > This deviation due to distortion is noticeably more pronounced near the edges of images, causing the marked point to deviate from the desired calculated location.\n> > \n> > A different project called PIX4D, which is used for drone mapping and photogrammetry, has published how they account for lens distortion. Proper angle calculation is very important for photogrammetry's technique of stitching together images taken from different angles, so we may assume their model is reasonably accurate:\n> > \n> > https://support.pix4d.com/hc/en-us/articles/202559089-How-are-the-Internal-and-External-Camera-Parameters-defined\n> > \n> > We need to store R\u2081, R\u2082, R\u2083, T\u2081, and T\u2082 for common camera models, and use the equations as defined above to apply a correction for lens distortion which then allows us to use the pinhole camera model appropriately for ray angle calculation\n> > \n> > @sethgcanada \n> > \n> > \n> > mkrupczak3: It turns out we don't have to re-work these equations like I thought, all that's needed is code to solve for Xd and Yd and use those for trig angle calculation instead of un-corrected Xh and Yh as is done currently\n> > \n> > \n> > mkrupczak3: One implementation problem is that often drone images are scaled up or down from their original size, while the calibrated distortion parameters are in terms of pixels of the image size that was used for calibration. \n> > \n> > We cannot assume the size of the image loaded will be the same as the size that the parameters are calculated for (such as if it is automatically scaled down when sent over a messaging app): Therefore it is necessary to adjust the distortion parameters based on the image scale.\n> > \n> > Interestingly, the distortion parameters won't scale linearly with the image scale. I haven't checked the math, but I believe they may be defined however, by mathematical formula(s) involving the original parameter and an arbitrary scale value `n` (see the last entry [here](https://chat.openai.com/share/f35a1b48-461c-4dd6-bd44-f19d0fdbe45c))\n> > \n> > In brief, this suggests that the new distortion coefficients for the scaled resolution image could be:\n> > \n> > R1' = R1 / n^2\n> > R2' = R2 / n^4\n> > R3' = R3 / n^6\n> > T1' = T1 / n\n> > T2' = T2 / n\n> > \n> > The [existing code in MetadataExtractor.java](https://github.com/Theta-Limited/OpenAthenaAndroid/blob/8ef35c8b48f308b85bb79c288721e707f59184fd/app/src/main/java/com/openathena/MetadataExtractor.java#L785) calculates `scaleRatio` based on the digital zoom (center crop) ratio, the image width, and the expected full resolution width of the image (the vertical size is not used because these pixels are often cropped automatically to make an image fit 16:9 frame). This scale ratio may likely be used as `n` for the equations listed above.\n> > \n> > From there, once the distortion equation is applied, Xd and Yd may be calculated, and then the ray angle may be calculated using each of their tangents with the focal length (in pixels) as normal:\n> > https://github.com/Theta-Limited/OpenAthenaAndroid/blob/8ef35c8b48f308b85bb79c288721e707f59184fd/app/src/main/java/com/openathena/MetadataExtractor.java#L872\n> > \n> > \n> > mkrupczak3: Another really good description of the math of image distortion:\n> > \n> > https://www.mathworks.com/help/vision/ug/camera-calibration.html#:~:text=The%20intrinsic%20parameters%20represent%20the,plane%20using%20the%20intrinsics%20parameters.\n> > \n> > \n> > mkrupczak3: Oh, @sethgcanada  forgot to mention, there are two different distortion models depending on the type of lens: `perspective` or `fisheye`. See [the earlier page from PIX4D](https://support.pix4d.com/hc/en-us/articles/202559089-How-are-the-Internal-and-External-Camera-Parameters-defined) for the relevant equations for each. \n> > \n> > While the scale equations for perspective lenses are as described above, you will need to do some linear algebra to determine the appropriate image scale conversions for `c`, `d`, `e`, and `f` if the lensType is a fisheye camera and the image resolution is scaled different from what is expected.\n> > \n> > Here's an example of what the JSON entries for a `perspective` and a `fisheye` camera will look like:\n> > \n> > `perspective`:\n> > ```JSON\n> >     {\n> >       \"makeModel\": \"skydio2\",\n> >       \"isThermal\": false,\n> >       \"ccdWidthMMPerPixel\": \"6.14571/4056.0\",\n> >       \"ccdHeightMMPerPixel\": \"4.504078/3040.0\",\n> >       \"widthPixels\": 4056,\n> >       \"heightPixels\": 3040,\n> >       \"comment\": \"Skydio 2 and 2+ Sony IMX577 1/2.3\u201d 12.3MP CMOS\",\n> >       \"lensType\": \"perspective\",\n> >       \"radialR1\": 0.134437,\n> >       \"radialR2\": -0.24607,\n> >       \"radialR3\": 0.104529,\n> >       \"tangentialT1\": -0.000175531,\n> >       \"tangentialT2\": -0.000580392\n> >     }\n> > ```\n> > \n> > `fisheye`:\n> > ```JSON\n> >     {\n> >       \"makeModel\": \"parrotBEBOP 2\",\n> >       \"isThermal\": false,\n> >       \"ccdWidthMMPerPixel\": \"5.7344/4096.0\",\n> >       \"ccdHeightMMPerPixel\": \"4.648/3072.0\",\n> >       \"widthPixels\": 4096,\n> >       \"heightPixels\": 3072,\n> >       \"comment\": \"1/2.3in 14 MP unnamed sensor\",\n> >       \"lensType\": \"fisheye\",\n> >       \"c\": 1101.96,\n> >       \"d\": 0.0,\n> >       \"e\": 0.0,\n> >       \"f\": 1101.96\n> >     }\n> > ```    \n> > \n> > For example: in `MetadataExtractor.java`, to get the `JSONObject` matching the `ExifInterface` `exif` of an image being analyzed you would run the following:\n> > ```\n> > JSONObject matchingDrone = getMatchingDrone(exif);\n> > ```\n> > \n> > From there, to obtain the `lensType` String you would run:\n> > ```\n> > String lensType = matchingDrone.getString(\"lensType\");\n> > ```\n> > \n> > All the necessary remaining quantitative parameters can be gotten with respective:\n> > ```\n> > String key = \"xxx\";\n> > Double value = matchingDrone.getDouble(key);\n> > ```\n> > \n> > You may also use the `JSONObject` function `.has(String key)` as a safe way to check if a key exists:\n> > ```\n> > if (drone != null && drone.has(\"focalLength\")) {\n> >     doSomething();\n> > }\n> > ```\n> > \n> > \n> > mkrupczak3: Also if the values for distortion parameters are all 0.0, then this actually means the data is missing. In this case, just use the existing pinhole camera model without correcting for distortion\n> > \n> > \n> > mkrupczak3: My \n> > \n> > > One implementation problem is that often drone images are scaled up or down from their original size, while the calibrated distortion parameters are in terms of pixels of the image size that was used for calibration.\n> > > \n> > > We cannot assume the size of the image loaded will be the same as the size that the parameters are calculated for (such as if it is automatically scaled down when sent over a messaging app): Therefore it is necessary to adjust the distortion parameters based on the image scale.\n> > > \n> > > Interestingly, the distortion parameters won't scale linearly with the image scale. I haven't checked the math, but I believe they may be defined however, by mathematical formula(s) involving the original parameter and an arbitrary scale value `n` (see the last entry [here](https://chat.openai.com/share/f35a1b48-461c-4dd6-bd44-f19d0fdbe45c))\n> > > \n> > > In brief, this suggests that the new distortion coefficients for the scaled resolution image could be:\n> > > \n> > > R1' = R1 / n^2 R2' = R2 / n^4 R3' = R3 / n^6 T1' = T1 / n T2' = T2 / n\n> > > \n> > > The [existing code in MetadataExtractor.java](https://github.com/Theta-Limited/OpenAthenaAndroid/blob/8ef35c8b48f308b85bb79c288721e707f59184fd/app/src/main/java/com/openathena/MetadataExtractor.java#L785) calculates `scaleRatio` based on the digital zoom (center crop) ratio, the image width, and the expected full resolution width of the image (the vertical size is not used because these pixels are often cropped automatically to make an image fit 16:9 frame). This scale ratio may likely be used as `n` for the equations listed above.\n> > > \n> > > From there, once the distortion equation is applied, Xd and Yd may be calculated, and then the ray angle may be calculated using each of their tangents with the focal length (in pixels) as normal:\n> > > \n> > > https://github.com/Theta-Limited/OpenAthenaAndroid/blob/8ef35c8b48f308b85bb79c288721e707f59184fd/app/src/main/java/com/openathena/MetadataExtractor.java#L872\n> > \n> > These equations were wrong, there's no need to alter any of the distortion parameters based on the size of the image. The current code which applies the scale correction for fx, fy, cx, and cy is already there and should be all that's needed\n> > \n> > \n> > mkrupczak3: via ChatGPT:\n> > \n> > > I apologize for the confusion earlier. Here's a step-by-step process to calculate \u03b8x and \u03b8y from a pixel in a distorted image:\n> > > \n> > > 1. **Undistort the pixel coordinates**: The first step is to correct the distorted pixel coordinates to undistorted pixel coordinates. This is typically done using an iterative process, as the distortion equations are nonlinear and do not have a simple inverse. You might start with an initial guess for the undistorted coordinates (for example, the distorted coordinates), and then repeatedly apply the distortion model and adjust the coordinates until the distorted coordinates match the observed coordinates. The distortion model equations are given by:\n> > > \n> > >     xdistorted = x(1 + k1*r^2 + k2*r^4 + k3*r^6) + [2 * p1 * x * y + p2 * (r^2 + 2 * x^2)]\n> > >     ydistorted = y(1 + k1*r^2 + k2*r^4 + k3*r^6) + [p1 * (r^2 + 2 *y^2) + 2 * p2 * x * y]\n> > > \n> > >     Here, (x, y) are the undistorted pixel locations in normalized image coordinates, (xdistorted, ydistorted) are the distorted pixel locations, r^2 = x^2 + y^2, and k1, k2, k3, p1, and p2 are the distortion coefficients.\n> > > \n> > > 2. **Normalize the pixel coordinates**: Subtract the principal point coordinates (cx, cy) from the undistorted pixel coordinates, and divide by the focal length (fx, fy) to convert the pixel coordinates to normalized image coordinates. This will give you the coordinates (x, y) of the point in the camera's image plane, in units of the focal length.\n> > > \n> > >     xnormalized = (xundistorted - cx) / fx\n> > >     ynormalized = (yundistorted - cy) / fy\n> > > \n> > > 3. **Convert to angles**: The normalized image coordinates (xnormalized, ynormalized) represent the tangent of the angles from the principal axis. So you can use the arctangent function to convert these coordinates to angles. The horizontal angle \u03b8x is given by \u03b8x = atan(xnormalized), and the vertical angle \u03b8y is given by \u03b8y = atan(ynormalized).\n> > > \n> > > Please note that these angles are relative to the principal axis of the camera, which is the line from the camera center through the principal point. The angles are positive in the direction of increasing pixel coordinates, and are measured in radians. The horizontal angle is zero for points on the principal axis, positive for points to the right of the principal axis, and negative for points to the left. Similarly, the vertical angle is zero for points on the principal axis, positive for points below the principal axis (since y-coordinates increase downwards in image coordinates), and negative for points above.\n> > \n> > \n> > mkrupczak3: More from ChatGPT on using Newton's method for finding the homogeneous point given the known distorted point in the original image:\n> > \n> > > The distortion equations are nonlinear and do not have a simple closed-form inverse, which is why an iterative approach is often used to solve for the undistorted coordinates. However, it is possible to approximate the inverse using a series expansion, or to solve for the undistorted coordinates using a numerical method such as Newton's method.\n> > > \n> > > Here is an example of how you might use Newton's method to solve for the undistorted x-coordinate given the distorted x-coordinate:\n> > > \n> > > 1. Start with an initial guess for the undistorted x-coordinate. A good initial guess might be the distorted x-coordinate.\n> > > \n> > > 2. Calculate the distorted x-coordinate using the distortion model equation:\n> > > \n> > >     xdistorted = x(1 + k1*r^2 + k2*r^4 + k3*r^6) + [2 * p1 * x * y + p2 * (r^2 + 2 * x^2)]\n> > > \n> > > 3. Calculate the difference between the calculated distorted x-coordinate and the given distorted x-coordinate.\n> > > \n> > > 4. If the difference is less than a small tolerance, stop and return the current guess for the undistorted x-coordinate.\n> > > \n> > > 5. Otherwise, calculate the derivative of the distortion model equation with respect to the undistorted x-coordinate, and use this to update the guess for the undistorted x-coordinate:\n> > > \n> > >     x = x - (xdistorted - xcalculated) / derivative\n> > > \n> > > 6. Repeat steps 2-5 until the difference is less than the tolerance or the maximum number of iterations is reached.\n> > > \n> > > This process can be repeated for the y-coordinate.\n> > > \n> > > Please note that this method requires calculating the derivative of the distortion model equation, which can be complex due to the nonlinear terms. It also requires choosing a suitable tolerance and maximum number of iterations. If the method does not converge, it may be necessary to try a different initial guess or to use a different numerical method.\n> > \n> > \n> > mkrupczak3: The accuracy issue seems to be most pronounced with fisheye lenses, see an example here:\n> > \n> > ![fisheye_fail_optimized](https://github.com/Theta-Limited/OpenAthenaAndroid/assets/25494111/bd20259e-6a86-4a91-b291-e24bb3082340)\n> > \n> > This issue may be related to the user reported issue #79 \n> > \n> > \n> > \n> > \n> > +-+\n> > \n> > The list of files in the repo is:\n> > ```.gitignore (240 tokens)\n> > .gitmodules (55 tokens)\n> > LICENSE (8075 tokens)\n> > README.md (2786 tokens)\n> > build.gradle (92 tokens)\n> > gradle.properties (333 tokens)\n> > gradlew (2469 tokens)\n> > gradlew.bat (975 tokens)\n> > settings.gradle (138 tokens)\n> > transifex.yml (95 tokens)\n> > .idea/.gitignore (16 tokens)\n> > .idea/OpenAthenaAndroid.iml (337 tokens)\n> > .idea/compiler.xml (55 tokens)\n> > .idea/gradle.xml (344 tokens)\n> > .idea/misc.xml (917 tokens)\n> > .idea/modules.xml (394 tokens)\n> > .idea/vcs.xml (66 tokens)\n> > app/.gitignore (2 tokens)\n> > app/build.gradle (541 tokens)\n> > app/proguard-rules.pro (198 tokens)\n> > .github/workflows/autopr.yml (544 tokens)\n> > app/debug/output-metadata.json (178 tokens)\n> > app/mgrs/.gitignore (3 tokens)\n> > app/mgrs/gradlew (2233 tokens)\n> > app/mgrs/gradlew.bat (923 tokens)\n> > gradle/wrapper/gradle-wrapper.properties (85 tokens)\n> > metadata/en-US/full_description.txt (93 tokens)\n> > metadata/en-US/short_description.txt (11 tokens)\n> > metadata/zh-CN/full_description.txt (0 tokens)\n> > metadata/zh-CN/short_description.txt (0 tokens)\n> > app/src/main/AndroidManifest.xml (1260 tokens)\n> > metadata/en-US/changelogs/10.txt (20 tokens)\n> > metadata/en-US/changelogs/11.txt (5 tokens)\n> > metadata/en-US/changelogs/12.txt (11 tokens)\n> > metadata/en-US/changelogs/13.txt (1 tokens)\n> > metadata/en-US/changelogs/14.txt (7 tokens)\n> > metadata/en-US/changelogs/15.txt (12 tokens)\n> > metadata/en-US/changelogs/8.txt (161 tokens)\n> > metadata/en-US/changelogs/9.txt (86 tokens)\n> > app/mgrs/gradle/wrapper/gradle-wrapper.properties (84 tokens)\n> > app/mgrs/src/main/AndroidManifest.xml (47 tokens)\n> > app/src/main/javadoc/overview.html (639 tokens)\n> > app/src/main/resources/mgrs.properties (1140 tokens)\n> > app/src/test/resources/.gitattributes (203 tokens)\n> > app/src/test/resources/README (370 tokens)\n> > app/src/test/resources/java.policy (8943 tokens)\n> > app/src/test/resources/lang-708-input.txt (2693 tokens)\n> > app/src/test/resources/log4j.properties (130 tokens)\n> > app/src/main/java/samples/XMPCoreCoverage.java (12891 tokens)\n> > app/src/main/java/samples/XMPCoreCoverageConst.java (5246 tokens)\n> > app/src/main/res/drawable-v24/ic_launcher_foreground.xml (1061 tokens)\n> > app/src/main/res/drawable/ic_launcher_background.xml (2638 tokens)\n> > app/src/main/res/layout-land/activity_about.xml (991 tokens)\n> > app/src/main/res/layout-land/activity_main.xml (2280 tokens)\n> > app/src/main/res/layout-land/activity_prefs.xml (2354 tokens)\n> > app/src/main/res/layout/activity_about.xml (947 tokens)\n> > app/src/main/res/layout/activity_log.xml (442 tokens)\n> > app/src/main/res/layout/activity_main.xml (1989 tokens)\n> > app/src/main/res/layout/activity_prefs.xml (2078 tokens)\n> > app/src/main/res/layout/activity_selection.xml (329 tokens)\n> > app/src/main/res/menu/menu_main.xml (320 tokens)\n> > app/src/main/res/mipmap-anydpi-v26/ic_launcher.xml (98 tokens)\n> > app/src/main/res/mipmap-anydpi-v26/ic_launcher_round.xml (98 tokens)\n> > app/src/main/res/values-fr/strings.xml (3981 tokens)\n> > app/src/main/res/values-ja/strings.xml (4781 tokens)\n> > app/src/main/res/values-ko/strings.xml (5981 tokens)\n> > app/src/main/res/values-land/dimens.xml (26 tokens)\n> > app/src/main/res/values-night/themes.xml (318 tokens)\n> > app/src/main/res/values-pl/strings.xml (4453 tokens)\n> > app/src/main/res/values-ru/strings.xml (6457 tokens)\n> > app/src/main/res/values-uk/strings.xml (6475 tokens)\n> > app/src/main/res/values-w1240dp/dimens.xml (26 tokens)\n> > app/src/main/res/values-w600dp/dimens.xml (26 tokens)\n> > app/src/main/res/values-zh/strings.xml (4727 tokens)\n> > app/src/main/res/values/colors.xml (161 tokens)\n> > app/src/main/res/values/dimens.xml (26 tokens)\n> > app/src/main/res/values/strings.xml (3221 tokens)\n> > app/src/main/res/values/themes.xml (454 tokens)\n> > app/src/main/res/xml/backup_rules.xml (160 tokens)\n> > app/src/main/res/xml/data_extraction_rules.xml (221 tokens)\n> > app/src/main/resources/META-INF/MANIFEST.MF (205 tokens)\n> > app/mgrs/src/main/res/values/strings.xml (8 tokens)\n> > app/src/androidTest/java/com/openathena/ExampleInstrumentedTest.java (248 tokens)\n> > app/src/main/java/com/openathena/AboutActivity.java (3054 tokens)\n> > app/src/main/java/com/openathena/ActivityLog.java (2599 tokens)\n> > app/src/main/java/com/openathena/AthenaActivity.java (6517 tokens)\n> > app/src/main/java/com/openathena/AthenaApp.java (1459 tokens)\n> > app/src/main/java/com/openathena/CK42_Gauss_Kr\u00fcger_Translator.java (2137 tokens)\n> > app/src/main/java/com/openathena/CoordTranslator.java (778 tokens)\n> > app/src/main/java/com/openathena/CursorOnTargetSender.java (4168 tokens)\n> > app/src/main/java/com/openathena/DEMParser.java (13895 tokens)\n> > app/src/main/java/com/openathena/DTEDParser.java (632 tokens)\n> > app/src/main/java/com/openathena/DroneParameterProvider.java (67 tokens)\n> > app/src/main/java/com/openathena/DroneParametersFromJSON.java (951 tokens)\n> > app/src/main/java/com/openathena/EGM96OffsetAdapter.java (374 tokens)\n> > app/src/main/java/com/openathena/EGMOffsetProvider.java (44 tokens)\n> > app/src/main/java/com/openathena/MainActivity.java (19266 tokens)\n> > app/src/main/java/com/openathena/MarkableImageView.java (4048 tokens)\n> > app/src/main/java/com/openathena/MetadataExtractor.java (14859 tokens)\n> > app/src/main/java/com/openathena/MissingDataException.java (249 tokens)\n> > app/src/main/java/com/openathena/PrefsActivity.java (2144 tokens)\n> > app/src/main/java/com/openathena/RequestedValueOOBException.java (326 tokens)\n> > app/src/main/java/com/openathena/SelectionActivity.java (2346 tokens)\n> > app/src/main/java/com/openathena/TargetGetter.java (6617 tokens)\n> > app/src/main/java/com/openathena/WGS84_CK42_Geodetic_Translator.java (3211 tokens)\n> > app/src/main/java/com/openathena/geodataAxisParams.java (110 tokens)\n> > app/src/main/java/org/slf4j/ILoggerFactory.java (735 tokens)\n> > app/src/main/java/org/slf4j/IMarkerFactory.java (940 tokens)\n> > app/src/main/java/org/slf4j/Logger.java (8492 tokens)\n> > app/src/main/java/org/slf4j/LoggerFactory.java (7159 tokens)\n> > app/src/main/java/org/slf4j/LoggerFactoryFriend.java (280 tokens)\n> > app/src/main/java/org/slf4j/MDC.java (3347 tokens)\n> > app/src/main/java/org/slf4j/Marker.java (1541 tokens)\n> > app/src/main/java/org/slf4j/MarkerFactory.java (1164 tokens)\n> > app/src/main/java/org/slf4j/package.html (91 tokens)\n> > app/src/main/resources/META-INF/proguard/org.threeten.bp.pro (24 tokens)\n> > app/src/main/resources/META-INF/services/org.threeten.bp.zone.ZoneRulesProvider (17 tokens)\n> > app/src/test/java/com/openathena/ExampleUnitTest.java (130 tokens)\n> > app/src/test/java/org/slf4j/BasicMarkerTest.java (2875 tokens)\n> > app/src/test/java/org/slf4j/Differentiator.java (442 tokens)\n> > app/src/test/java/org/slf4j/DoubleCheckedInt.java (2150 tokens)\n> > app/src/test/java/org/slf4j/LoggerAccessingThread.java (845 tokens)\n> > app/src/test/java/org/slf4j/NoBindingTest.java (684 tokens)\n> > app/src/main/java/com/adobe/xmp/XMPConst.java (2660 tokens)\n> > app/src/main/java/com/adobe/xmp/XMPDateTime.java (1171 tokens)\n> > app/src/main/java/com/adobe/xmp/XMPDateTimeFactory.java (1769 tokens)\n> > app/src/main/java/com/adobe/xmp/XMPError.java (292 tokens)\n> > app/src/main/java/com/adobe/xmp/XMPException.java (363 tokens)\n> > app/src/main/java/com/adobe/xmp/XMPIterator.java (954 tokens)\n> > app/src/main/java/com/adobe/xmp/XMPMeta.java (15441 tokens)\n> > app/src/main/java/com/adobe/xmp/XMPMetaFactory.java (3149 tokens)\n> > app/src/main/java/com/adobe/xmp/XMPPathFactory.java (3761 tokens)\n> > app/src/main/java/com/adobe/xmp/XMPSchemaRegistry.java (1806 tokens)\n> > app/src/main/java/com/adobe/xmp/XMPUtils.java (6110 tokens)\n> > app/src/main/java/com/adobe/xmp/XMPVersionInfo.java (342 tokens)\n> > app/src/main/java/com/adobe/xmp/package.html (152 tokens)\n> > app/src/main/java/com/agilesrc/dem4j/BoundingBox.java (1605 tokens)```\n> > \n> > Should we take a look at any files? If so, pick only a few files (max 5000 tokens). \n> > Respond with a very short rationale, and a list of files.\n> > If looking at files would be a waste of time with regard to the issue, respond with an empty list.\n> > ~~~\n> > \n> > </details>\n> </details>\n</details>\n\n\u26a0\ufe0f\u26a0\ufe0f\u26a0\ufe0f Your OpenAI API key does not have access to the `gpt-4` model. Please note that ChatGPT Plus does not give you access to the `gpt-4` API; you need to sign up on [the GPT-4 API waitlist](https://openai.com/waitlist/gpt-4-api). \n\n<details>\n<summary>Error</summary>\n\n~~~python\nTraceback (most recent call last):\n  File \"/app/autopr/services/action_service.py\", line 186, in run_action\n    results = action.run(arguments, context)\n  File \"/app/autopr/actions/look_at_files.py\", line 375, in run\n    filepaths = self.get_initial_filepaths(files, context)\n  File \"/app/autopr/actions/look_at_files.py\", line 276, in get_initial_filepaths\n    response = self.rail_service.run_prompt_rail(\n  File \"/app/autopr/services/rail_service.py\", line 355, in run_prompt_rail\n    prompt = self.completions_repo.complete(\n  File \"/app/autopr/repos/completions_repo.py\", line 84, in complete\n    raise e\n  File \"/app/autopr/repos/completions_repo.py\", line 65, in complete\n    result = self._complete(\n  File \"/venv/lib/python3.9/site-packages/tenacity/__init__.py\", line 289, in wrapped_f\n    return self(f, *args, **kw)\n  File \"/venv/lib/python3.9/site-packages/tenacity/__init__.py\", line 379, in __call__\n    do = self.iter(retry_state=retry_state)\n  File \"/venv/lib/python3.9/site-packages/tenacity/__init__.py\", line 314, in iter\n    return fut.result()\n  File \"/usr/local/lib/python3.9/concurrent/futures/_base.py\", line 439, in result\n    return self.__get_result()\n  File \"/usr/local/lib/python3.9/concurrent/futures/_base.py\", line 391, in __get_result\n    raise self._exception\n  File \"/venv/lib/python3.9/site-packages/tenacity/__init__.py\", line 382, in __call__\n    result = fn(*args, **kwargs)\n  File \"/app/autopr/repos/completions_repo.py\", line 142, in _complete\n    openai_response = openai.ChatCompletion.create(\n  File \"/venv/lib/python3.9/site-packages/openai/api_resources/chat_completion.py\", line 25, in create\n    return super().create(*args, **kwargs)\n  File \"/venv/lib/python3.9/site-packages/openai/api_resources/abstract/engine_api_resource.py\", line 153, in create\n    response, _, api_key = requestor.request(\n  File \"/venv/lib/python3.9/site-packages/openai/api_requestor.py\", line 230, in request\n    resp, got_stream = self._interpret_response(result, stream)\n  File \"/venv/lib/python3.9/site-packages/openai/api_requestor.py\", line 624, in _interpret_response\n    self._interpret_response_line(\n  File \"/venv/lib/python3.9/site-packages/openai/api_requestor.py\", line 687, in _interpret_response_line\n    raise self.handle_error_response(\nopenai.error.InvalidRequestError: The model `gpt-4` does not exist or you do not have access to it. Learn more: https://help.openai.com/en/articles/7102672-how-can-i-access-gpt-4.\n\n~~~\n\n</details>",
                        "comments": {
                            "nodes": [
                                {
                                    "createdAt": "2023-07-23T19:43:38Z",
                                    "bodyText": "Thank you for your submission! We really appreciate it. Like many open source projects, we ask that you sign our Contributor License Agreement before we can accept your contribution.AutoPR seems not to be a GitHub user. You need a GitHub account to be able to sign the CLA. If you have already a GitHub account, please add the email address used for this commit to your account.You have signed the CLA already but the status is still pending? Let us recheck it.",
                                    "url": "https://github.com/Theta-Limited/OpenAthenaAndroid/pull/84#issuecomment-1646943803",
                                    "author": {
                                        "login": "CLAassistant"
                                    }
                                }
                            ]
                        },
                        "reviews": {
                            "edges": []
                        }
                    },
                    "textMatches": [
                        {
                            "property": "body"
                        }
                    ]
                },
                {
                    "node": {
                        "number": 82,
                        "title": "Fix #74: Correct for Lens Distortion for ray angle calculation",
                        "repository": {
                            "nameWithOwner": "Theta-Limited/OpenAthenaAndroid",
                            "primaryLanguage": {
                                "name": "Java"
                            }
                        },
                        "createdAt": "2023-07-23T17:34:25Z",
                        "mergedAt": null,
                        "url": "https://github.com/Theta-Limited/OpenAthenaAndroid/pull/82",
                        "state": "CLOSED",
                        "author": {
                            "login": "mkrupczak3"
                        },
                        "editor": {
                            "login": "mkrupczak3"
                        },
                        "body": "[![AutoPR Failure](https://img.shields.io/badge/AutoPR-failure-red)](https://github.com/Theta-Limited/OpenAthenaAndroid/actions/runs/5637768844)\n\nFixes #74\n\n## Status\n\nThis pull request was being autonomously generated by [AutoPR](https://github.com/irgolic/AutoPR), but it encountered an error.\n\nError:\n\n```\nTraceback (most recent call last):\n  File \"/app/autopr/services/action_service.py\", line 186, in run_action\n    results = action.run(arguments, context)\n  File \"/app/autopr/actions/look_at_files.py\", line 375, in run\n    filepaths = self.get_initial_filepaths(files, context)\n  File \"/app/autopr/actions/look_at_files.py\", line 276, in get_initial_filepaths\n    response = self.rail_service.run_prompt_rail(\n  File \"/app/autopr/services/rail_service.py\", line 355, in run_prompt_rail\n    prompt = self.completions_repo.complete(\n  File \"/app/autopr/repos/completions_repo.py\", line 84, in complete\n    raise e\n  File \"/app/autopr/repos/completions_repo.py\", line 65, in complete\n    result = self._complete(\n  File \"/venv/lib/python3.9/site-packages/tenacity/__init__.py\", line 289, in wrapped_f\n    return self(f, *args, **kw)\n  File \"/venv/lib/python3.9/site-packages/tenacity/__init__.py\", line 379, in __call__\n    do = self.iter(retry_state=retry_state)\n  File \"/venv/lib/python3.9/site-packages/tenacity/__init__.py\", line 314, in iter\n    return fut.result()\n  File \"/usr/local/lib/python3.9/concurrent/futures/_base.py\", line 439, in result\n    return self.__get_result()\n  File \"/usr/local/lib/python3.9/concurrent/futures/_base.py\", line 391, in __get_result\n    raise self._exception\n  File \"/venv/lib/python3.9/site-packages/tenacity/__init__.py\", line 382, in __call__\n    result = fn(*args, **kwargs)\n  File \"/app/autopr/repos/completions_repo.py\", line 142, in _complete\n    openai_response = openai.ChatCompletion.create(\n  File \"/venv/lib/python3.9/site-packages/openai/api_resources/chat_completion.py\", line 25, in create\n    return super().create(*args, **kwargs)\n  File \"/venv/lib/python3.9/site-packages/openai/api_resources/abstract/engine_api_resource.py\", line 153, in create\n    response, _, api_key = requestor.request(\n  File \"/venv/lib/python3.9/site-packages/openai/api_requestor.py\", line 230, in request\n    resp, got_stream = self._interpret_response(result, stream)\n  File \"/venv/lib/python3.9/site-packages/openai/api_requestor.py\", line 624, in _interpret_response\n    self._interpret_response_line(\n  File \"/venv/lib/python3.9/site-packages/openai/api_requestor.py\", line 687, in _interpret_response_line\n    raise self.handle_error_response(\nopenai.error.InvalidRequestError: The model `gpt-4` does not exist or you do not have access to it. Learn more: https://help.openai.com/en/articles/7102672-how-can-i-access-gpt-4.\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/app/autopr/services/agent_service.py\", line 78, in run_agent\n    agent.handle_event(event)\n  File \"/app/autopr/agents/plan_and_code.py\", line 216, in handle_event\n    self.create_pull_request(event)\n  File \"/app/autopr/agents/plan_and_code.py\", line 176, in create_pull_request\n    context = self.action_service.run_actions_iteratively(\n  File \"/app/autopr/services/action_service.py\", line 215, in run_actions_iteratively\n    context = self.run_action(action_id, context)\n  File \"/app/autopr/services/action_service.py\", line 195, in run_action\n    self.publish_service.end_section(f\"\u274c Failed {action_id}\")\n  File \"/app/autopr/services/publish_service.py\", line 237, in end_section\n    raise ValueError(\"Cannot end root section\")\nValueError: Cannot end root section\n\n```\n\nPlease <a href=\"https://github.com/irgolic/AutoPR/issues/new?title=ValueError:%20Cannot%20end%20root%20section&labels=bug&body=%0A[![AutoPR%20Failure](https://img.shields.io/badge/AutoPR-failure-red)](https://github.com/Theta-Limited/OpenAthenaAndroid/actions/runs/5637768844)%0A%0AAutoPR%20encountered%20an%20error.%20%20%0AIssue:%20https://github.com/Theta-Limited/OpenAthenaAndroid/issues/74%20%20%0APull%20Request:%20https://github.com/Theta-Limited/OpenAthenaAndroid/pull/82%0A%0A%0A%23%23%20Traceback%0A%0A```%0ATraceback%20(most%20recent%20call%20last):%0A%20%20File%20%22/app/autopr/services/action_service.py%22,%20line%20186,%20in%20run_action%0A%20%20%20%20results%20=%20action.run(arguments,%20context)%0A%20%20File%20%22/app/autopr/actions/look_at_files.py%22,%20line%20375,%20in%20run%0A%20%20%20%20filepaths%20=%20self.get_initial_filepaths(files,%20context)%0A%20%20File%20%22/app/autopr/actions/look_at_files.py%22,%20line%20276,%20in%20get_initial_filepaths%0A%20%20%20%20response%20=%20self.rail_service.run_prompt_rail(%0A%20%20File%20%22/app/autopr/services/rail_service.py%22,%20line%20355,%20in%20run_prompt_rail%0A%20%20%20%20prompt%20=%20self.completions_repo.complete(%0A%20%20File%20%22/app/autopr/repos/completions_repo.py%22,%20line%2084,%20in%20complete%0A%20%20%20%20raise%20e%0A%20%20File%20%22/app/autopr/repos/completions_repo.py%22,%20line%2065,%20in%20complete%0A%20%20%20%20result%20=%20self._complete(%0A%20%20File%20%22/venv/lib/python3.9/site-packages/tenacity/__init__.py%22,%20line%20289,%20in%20wrapped_f%0A%20%20%20%20return%20self(f,%20*args,%20**kw)%0A%20%20File%20%22/venv/lib/python3.9/site-packages/tenacity/__init__.py%22,%20line%20379,%20in%20__call__%0A%20%20%20%20do%20=%20self.iter(retry_state=retry_state)%0A%20%20File%20%22/venv/lib/python3.9/site-packages/tenacity/__init__.py%22,%20line%20314,%20in%20iter%0A%20%20%20%20return%20fut.result()%0A%20%20File%20%22/usr/local/lib/python3.9/concurrent/futures/_base.py%22,%20line%20439,%20in%20result%0A%20%20%20%20return%20self.__get_result()%0A%20%20File%20%22/usr/local/lib/python3.9/concurrent/futures/_base.py%22,%20line%20391,%20in%20__get_result%0A%20%20%20%20raise%20self._exception%0A%20%20File%20%22/venv/lib/python3.9/site-packages/tenacity/__init__.py%22,%20line%20382,%20in%20__call__%0A%20%20%20%20result%20=%20fn(*args,%20**kwargs)%0A%20%20File%20%22/app/autopr/repos/completions_repo.py%22,%20line%20142,%20in%20_complete%0A%20%20%20%20openai_response%20=%20openai.ChatCompletion.create(%0A%20%20File%20%22/venv/lib/python3.9/site-packages/openai/api_resources/chat_completion.py%22,%20line%2025,%20in%20create%0A%20%20%20%20return%20super().create(*args,%20**kwargs)%0A%20%20File%20%22/venv/lib/python3.9/site-packages/openai/api_resources/abstract/engine_api_resource.py%22,%20line%20153,%20in%20create%0A%20%20%20%20response,%20_,%20api_key%20=%20requestor.request(%0A%20%20File%20%22/venv/lib/python3.9/site-packages/openai/api_requestor.py%22,%20line%20230,%20in%20request%0A%20%20%20%20resp,%20got_stream%20=%20self._interpret_response(result,%20stream)%0A%20%20File%20%22/venv/lib/python3.9/site-packages/openai/api_requestor.py%22,%20line%20624,%20in%20_interpret_response%0A%20%20%20%20self._interpret_response_line(%0A%20%20File%20%22/venv/lib/python3.9/site-packages/openai/api_requestor.py%22,%20line%20687,%20in%20_interpret_response_line%0A%20%20%20%20raise%20self.handle_error_response(%0Aopenai.error.InvalidRequestError:%20The%20model%20`gpt-4`%20does%20not%20exist%20or%20you%20do%20not%20have%20access%20to%20it.%20Learn%20more:%20https://help.openai.com/en/articles/7102672-how-can-i-access-gpt-4.%0A%0ADuring%20handling%20of%20the%20above%20exception,%20another%20exception%20occurred:%0A%0ATraceback%20(most%20recent%20call%20last):%0A%20%20File%20%22/app/autopr/services/agent_service.py%22,%20line%2078,%20in%20run_agent%0A%20%20%20%20agent.handle_event(event)%0A%20%20File%20%22/app/autopr/agents/plan_and_code.py%22,%20line%20216,%20in%20handle_event%0A%20%20%20%20self.create_pull_request(event)%0A%20%20File%20%22/app/autopr/agents/plan_and_code.py%22,%20line%20176,%20in%20create_pull_request%0A%20%20%20%20context%20=%20self.action_service.run_actions_iteratively(%0A%20%20File%20%22/app/autopr/services/action_service.py%22,%20line%20215,%20in%20run_actions_iteratively%0A%20%20%20%20context%20=%20self.run_action(action_id,%20context)%0A%20%20File%20%22/app/autopr/services/action_service.py%22,%20line%20195,%20in%20run_action%0A%20%20%20%20self.publish_service.end_section(f%22\u274c%20Failed%20{action_id}%22)%0A%20%20File%20%22/app/autopr/services/publish_service.py%22,%20line%20237,%20in%20end_section%0A%20%20%20%20raise%20ValueError(%22Cannot%20end%20root%20section%22)%0AValueError:%20Cannot%20end%20root%20section%0A%0A```%0A\">open an issue</a> to report this.\n\n<details>\n<summary>\ud83d\udcd6 Looking at files</summary>\n\n> <details open>\n> <summary>\ud83d\udcac Asking for InitialFileSelect</summary>\n> \n> > <details open>\n> > <summary>Prompt</summary>\n> > \n> > ~~~\n> > Hey, somebody just opened an issue in my repo, could you help me write a pull request?\n> > \n> > Given context variables enclosed by +-+:\n> > \n> > Issue:\n> > +-+\n> > #74 Correct for Lens Distortion for ray angle calculation\n> > \n> > mkrupczak3: Our current calculation for ray angle from a selected image point is entirely based on the idealized [pinhole camera model](https://towardsdatascience.com/camera-intrinsic-matrix-with-example-in-python-d79bf2478c12?gi=8bd7b436d2d3). This makes no consideration of the properties of the actual camera lens, which introduces its own image distortion subtly different than may be expected in the pinhole camera model. These distortions may be especially pronounced with fisheye cameras or zoom lenses at larger focal lengths:\n> > https://en.wikipedia.org/wiki/Distortion_(optics)\n> > \n> > This deviation due to distortion is noticeably more pronounced near the edges of images, causing the marked point to deviate from the desired calculated location.\n> > \n> > A different project called PIX4D, which is used for drone mapping and photogrammetry, has published how they account for lens distortion. Proper angle calculation is very important for photogrammetry's technique of stitching together images taken from different angles, so we may assume their model is reasonably accurate:\n> > \n> > https://support.pix4d.com/hc/en-us/articles/202559089-How-are-the-Internal-and-External-Camera-Parameters-defined\n> > \n> > We need to store R\u2081, R\u2082, R\u2083, T\u2081, and T\u2082 for common camera models, and use the equations as defined above to apply a correction for lens distortion which then allows us to use the pinhole camera model appropriately for ray angle calculation\n> > \n> > @sethgcanada \n> > \n> > \n> > mkrupczak3: It turns out we don't have to re-work these equations like I thought, all that's needed is code to solve for Xd and Yd and use those for trig angle calculation instead of un-corrected Xh and Yh as is done currently\n> > \n> > \n> > mkrupczak3: One implementation problem is that often drone images are scaled up or down from their original size, while the calibrated distortion parameters are in terms of pixels of the image size that was used for calibration. \n> > \n> > We cannot assume the size of the image loaded will be the same as the size that the parameters are calculated for (such as if it is automatically scaled down when sent over a messaging app): Therefore it is necessary to adjust the distortion parameters based on the image scale.\n> > \n> > Interestingly, the distortion parameters won't scale linearly with the image scale. I haven't checked the math, but I believe they may be defined however, by mathematical formula(s) involving the original parameter and an arbitrary scale value `n` (see the last entry [here](https://chat.openai.com/share/f35a1b48-461c-4dd6-bd44-f19d0fdbe45c))\n> > \n> > In brief, this suggests that the new distortion coefficients for the scaled resolution image could be:\n> > \n> > R1' = R1 / n^2\n> > R2' = R2 / n^4\n> > R3' = R3 / n^6\n> > T1' = T1 / n\n> > T2' = T2 / n\n> > \n> > The [existing code in MetadataExtractor.java](https://github.com/Theta-Limited/OpenAthenaAndroid/blob/8ef35c8b48f308b85bb79c288721e707f59184fd/app/src/main/java/com/openathena/MetadataExtractor.java#L785) calculates `scaleRatio` based on the digital zoom (center crop) ratio, the image width, and the expected full resolution width of the image (the vertical size is not used because these pixels are often cropped automatically to make an image fit 16:9 frame). This scale ratio may likely be used as `n` for the equations listed above.\n> > \n> > From there, once the distortion equation is applied, Xd and Yd may be calculated, and then the ray angle may be calculated using each of their tangents with the focal length (in pixels) as normal:\n> > https://github.com/Theta-Limited/OpenAthenaAndroid/blob/8ef35c8b48f308b85bb79c288721e707f59184fd/app/src/main/java/com/openathena/MetadataExtractor.java#L872\n> > \n> > \n> > mkrupczak3: Another really good description of the math of image distortion:\n> > \n> > https://www.mathworks.com/help/vision/ug/camera-calibration.html#:~:text=The%20intrinsic%20parameters%20represent%20the,plane%20using%20the%20intrinsics%20parameters.\n> > \n> > \n> > mkrupczak3: Oh, @sethgcanada  forgot to mention, there are two different distortion models depending on the type of lens: `perspective` or `fisheye`. See [the earlier page from PIX4D](https://support.pix4d.com/hc/en-us/articles/202559089-How-are-the-Internal-and-External-Camera-Parameters-defined) for the relevant equations for each. \n> > \n> > While the scale equations for perspective lenses are as described above, you will need to do some linear algebra to determine the appropriate image scale conversions for `c`, `d`, `e`, and `f` if the lensType is a fisheye camera and the image resolution is scaled different from what is expected.\n> > \n> > Here's an example of what the JSON entries for a `perspective` and a `fisheye` camera will look like:\n> > \n> > `perspective`:\n> > ```JSON\n> >     {\n> >       \"makeModel\": \"skydio2\",\n> >       \"isThermal\": false,\n> >       \"ccdWidthMMPerPixel\": \"6.14571/4056.0\",\n> >       \"ccdHeightMMPerPixel\": \"4.504078/3040.0\",\n> >       \"widthPixels\": 4056,\n> >       \"heightPixels\": 3040,\n> >       \"comment\": \"Skydio 2 and 2+ Sony IMX577 1/2.3\u201d 12.3MP CMOS\",\n> >       \"lensType\": \"perspective\",\n> >       \"radialR1\": 0.134437,\n> >       \"radialR2\": -0.24607,\n> >       \"radialR3\": 0.104529,\n> >       \"tangentialT1\": -0.000175531,\n> >       \"tangentialT2\": -0.000580392\n> >     }\n> > ```\n> > \n> > `fisheye`:\n> > ```JSON\n> >     {\n> >       \"makeModel\": \"parrotBEBOP 2\",\n> >       \"isThermal\": false,\n> >       \"ccdWidthMMPerPixel\": \"5.7344/4096.0\",\n> >       \"ccdHeightMMPerPixel\": \"4.648/3072.0\",\n> >       \"widthPixels\": 4096,\n> >       \"heightPixels\": 3072,\n> >       \"comment\": \"1/2.3in 14 MP unnamed sensor\",\n> >       \"lensType\": \"fisheye\",\n> >       \"c\": 1101.96,\n> >       \"d\": 0.0,\n> >       \"e\": 0.0,\n> >       \"f\": 1101.96\n> >     }\n> > ```    \n> > \n> > For example: in `MetadataExtractor.java`, to get the `JSONObject` matching the `ExifInterface` `exif` of an image being analyzed you would run the following:\n> > ```\n> > JSONObject matchingDrone = getMatchingDrone(exif);\n> > ```\n> > \n> > From there, to obtain the `lensType` String you would run:\n> > ```\n> > String lensType = matchingDrone.getString(\"lensType\");\n> > ```\n> > \n> > All the necessary remaining quantitative parameters can be gotten with respective:\n> > ```\n> > String key = \"xxx\";\n> > Double value = matchingDrone.getDouble(key);\n> > ```\n> > \n> > You may also use the `JSONObject` function `.has(String key)` as a safe way to check if a key exists:\n> > ```\n> > if (drone != null && drone.has(\"focalLength\")) {\n> >     doSomething();\n> > }\n> > ```\n> > \n> > \n> > mkrupczak3: Also if the values for distortion parameters are all 0.0, then this actually means the data is missing. In this case, just use the existing pinhole camera model without correcting for distortion\n> > \n> > \n> > mkrupczak3: My \n> > \n> > > One implementation problem is that often drone images are scaled up or down from their original size, while the calibrated distortion parameters are in terms of pixels of the image size that was used for calibration.\n> > > \n> > > We cannot assume the size of the image loaded will be the same as the size that the parameters are calculated for (such as if it is automatically scaled down when sent over a messaging app): Therefore it is necessary to adjust the distortion parameters based on the image scale.\n> > > \n> > > Interestingly, the distortion parameters won't scale linearly with the image scale. I haven't checked the math, but I believe they may be defined however, by mathematical formula(s) involving the original parameter and an arbitrary scale value `n` (see the last entry [here](https://chat.openai.com/share/f35a1b48-461c-4dd6-bd44-f19d0fdbe45c))\n> > > \n> > > In brief, this suggests that the new distortion coefficients for the scaled resolution image could be:\n> > > \n> > > R1' = R1 / n^2 R2' = R2 / n^4 R3' = R3 / n^6 T1' = T1 / n T2' = T2 / n\n> > > \n> > > The [existing code in MetadataExtractor.java](https://github.com/Theta-Limited/OpenAthenaAndroid/blob/8ef35c8b48f308b85bb79c288721e707f59184fd/app/src/main/java/com/openathena/MetadataExtractor.java#L785) calculates `scaleRatio` based on the digital zoom (center crop) ratio, the image width, and the expected full resolution width of the image (the vertical size is not used because these pixels are often cropped automatically to make an image fit 16:9 frame). This scale ratio may likely be used as `n` for the equations listed above.\n> > > \n> > > From there, once the distortion equation is applied, Xd and Yd may be calculated, and then the ray angle may be calculated using each of their tangents with the focal length (in pixels) as normal:\n> > > \n> > > https://github.com/Theta-Limited/OpenAthenaAndroid/blob/8ef35c8b48f308b85bb79c288721e707f59184fd/app/src/main/java/com/openathena/MetadataExtractor.java#L872\n> > \n> > These equations were wrong, there's no need to alter any of the distortion parameters based on the size of the image. The current code which applies the scale correction for fx, fy, cx, and cy is already there and should be all that's needed\n> > \n> > \n> > mkrupczak3: via ChatGPT:\n> > \n> > > I apologize for the confusion earlier. Here's a step-by-step process to calculate \u03b8x and \u03b8y from a pixel in a distorted image:\n> > > \n> > > 1. **Undistort the pixel coordinates**: The first step is to correct the distorted pixel coordinates to undistorted pixel coordinates. This is typically done using an iterative process, as the distortion equations are nonlinear and do not have a simple inverse. You might start with an initial guess for the undistorted coordinates (for example, the distorted coordinates), and then repeatedly apply the distortion model and adjust the coordinates until the distorted coordinates match the observed coordinates. The distortion model equations are given by:\n> > > \n> > >     xdistorted = x(1 + k1*r^2 + k2*r^4 + k3*r^6) + [2 * p1 * x * y + p2 * (r^2 + 2 * x^2)]\n> > >     ydistorted = y(1 + k1*r^2 + k2*r^4 + k3*r^6) + [p1 * (r^2 + 2 *y^2) + 2 * p2 * x * y]\n> > > \n> > >     Here, (x, y) are the undistorted pixel locations in normalized image coordinates, (xdistorted, ydistorted) are the distorted pixel locations, r^2 = x^2 + y^2, and k1, k2, k3, p1, and p2 are the distortion coefficients.\n> > > \n> > > 2. **Normalize the pixel coordinates**: Subtract the principal point coordinates (cx, cy) from the undistorted pixel coordinates, and divide by the focal length (fx, fy) to convert the pixel coordinates to normalized image coordinates. This will give you the coordinates (x, y) of the point in the camera's image plane, in units of the focal length.\n> > > \n> > >     xnormalized = (xundistorted - cx) / fx\n> > >     ynormalized = (yundistorted - cy) / fy\n> > > \n> > > 3. **Convert to angles**: The normalized image coordinates (xnormalized, ynormalized) represent the tangent of the angles from the principal axis. So you can use the arctangent function to convert these coordinates to angles. The horizontal angle \u03b8x is given by \u03b8x = atan(xnormalized), and the vertical angle \u03b8y is given by \u03b8y = atan(ynormalized).\n> > > \n> > > Please note that these angles are relative to the principal axis of the camera, which is the line from the camera center through the principal point. The angles are positive in the direction of increasing pixel coordinates, and are measured in radians. The horizontal angle is zero for points on the principal axis, positive for points to the right of the principal axis, and negative for points to the left. Similarly, the vertical angle is zero for points on the principal axis, positive for points below the principal axis (since y-coordinates increase downwards in image coordinates), and negative for points above.\n> > \n> > \n> > mkrupczak3: More from ChatGPT on using Newton's method for finding the homogeneous point given the known distorted point in the original image:\n> > \n> > > The distortion equations are nonlinear and do not have a simple closed-form inverse, which is why an iterative approach is often used to solve for the undistorted coordinates. However, it is possible to approximate the inverse using a series expansion, or to solve for the undistorted coordinates using a numerical method such as Newton's method.\n> > > \n> > > Here is an example of how you might use Newton's method to solve for the undistorted x-coordinate given the distorted x-coordinate:\n> > > \n> > > 1. Start with an initial guess for the undistorted x-coordinate. A good initial guess might be the distorted x-coordinate.\n> > > \n> > > 2. Calculate the distorted x-coordinate using the distortion model equation:\n> > > \n> > >     xdistorted = x(1 + k1*r^2 + k2*r^4 + k3*r^6) + [2 * p1 * x * y + p2 * (r^2 + 2 * x^2)]\n> > > \n> > > 3. Calculate the difference between the calculated distorted x-coordinate and the given distorted x-coordinate.\n> > > \n> > > 4. If the difference is less than a small tolerance, stop and return the current guess for the undistorted x-coordinate.\n> > > \n> > > 5. Otherwise, calculate the derivative of the distortion model equation with respect to the undistorted x-coordinate, and use this to update the guess for the undistorted x-coordinate:\n> > > \n> > >     x = x - (xdistorted - xcalculated) / derivative\n> > > \n> > > 6. Repeat steps 2-5 until the difference is less than the tolerance or the maximum number of iterations is reached.\n> > > \n> > > This process can be repeated for the y-coordinate.\n> > > \n> > > Please note that this method requires calculating the derivative of the distortion model equation, which can be complex due to the nonlinear terms. It also requires choosing a suitable tolerance and maximum number of iterations. If the method does not converge, it may be necessary to try a different initial guess or to use a different numerical method.\n> > \n> > \n> > mkrupczak3: The accuracy issue seems to be most pronounced with fisheye lenses, see an example here:\n> > \n> > ![fisheye_fail_optimized](https://github.com/Theta-Limited/OpenAthenaAndroid/assets/25494111/bd20259e-6a86-4a91-b291-e24bb3082340)\n> > \n> > This issue may be related to the user reported issue #79 \n> > \n> > \n> > \n> > \n> > +-+\n> > \n> > The list of files in the repo is:\n> > ```.gitignore (240 tokens)\n> > .gitmodules (55 tokens)\n> > LICENSE (8075 tokens)\n> > README.md (2786 tokens)\n> > build.gradle (92 tokens)\n> > gradle.properties (333 tokens)\n> > gradlew (2469 tokens)\n> > gradlew.bat (975 tokens)\n> > settings.gradle (138 tokens)\n> > transifex.yml (95 tokens)\n> > .idea/.gitignore (16 tokens)\n> > .idea/OpenAthenaAndroid.iml (337 tokens)\n> > .idea/compiler.xml (55 tokens)\n> > .idea/gradle.xml (344 tokens)\n> > .idea/misc.xml (917 tokens)\n> > .idea/modules.xml (394 tokens)\n> > .idea/vcs.xml (66 tokens)\n> > app/.gitignore (2 tokens)\n> > app/build.gradle (541 tokens)\n> > app/proguard-rules.pro (198 tokens)\n> > .github/workflows/autopr.yml (548 tokens)\n> > app/debug/output-metadata.json (178 tokens)\n> > app/mgrs/.gitignore (3 tokens)\n> > app/mgrs/gradlew (2233 tokens)\n> > app/mgrs/gradlew.bat (923 tokens)\n> > gradle/wrapper/gradle-wrapper.properties (85 tokens)\n> > metadata/en-US/full_description.txt (93 tokens)\n> > metadata/en-US/short_description.txt (11 tokens)\n> > metadata/zh-CN/full_description.txt (0 tokens)\n> > metadata/zh-CN/short_description.txt (0 tokens)\n> > app/src/main/AndroidManifest.xml (1260 tokens)\n> > metadata/en-US/changelogs/10.txt (20 tokens)\n> > metadata/en-US/changelogs/11.txt (5 tokens)\n> > metadata/en-US/changelogs/12.txt (11 tokens)\n> > metadata/en-US/changelogs/13.txt (1 tokens)\n> > metadata/en-US/changelogs/14.txt (7 tokens)\n> > metadata/en-US/changelogs/15.txt (12 tokens)\n> > metadata/en-US/changelogs/8.txt (161 tokens)\n> > metadata/en-US/changelogs/9.txt (86 tokens)\n> > app/mgrs/gradle/wrapper/gradle-wrapper.properties (84 tokens)\n> > app/mgrs/src/main/AndroidManifest.xml (47 tokens)\n> > app/src/main/javadoc/overview.html (639 tokens)\n> > app/src/main/resources/mgrs.properties (1140 tokens)\n> > app/src/test/resources/.gitattributes (203 tokens)\n> > app/src/test/resources/README (370 tokens)\n> > app/src/test/resources/java.policy (8943 tokens)\n> > app/src/test/resources/lang-708-input.txt (2693 tokens)\n> > app/src/test/resources/log4j.properties (130 tokens)\n> > app/src/main/java/samples/XMPCoreCoverage.java (12891 tokens)\n> > app/src/main/java/samples/XMPCoreCoverageConst.java (5246 tokens)\n> > app/src/main/res/drawable-v24/ic_launcher_foreground.xml (1061 tokens)\n> > app/src/main/res/drawable/ic_launcher_background.xml (2638 tokens)\n> > app/src/main/res/layout-land/activity_about.xml (991 tokens)\n> > app/src/main/res/layout-land/activity_main.xml (2280 tokens)\n> > app/src/main/res/layout-land/activity_prefs.xml (2354 tokens)\n> > app/src/main/res/layout/activity_about.xml (947 tokens)\n> > app/src/main/res/layout/activity_log.xml (442 tokens)\n> > app/src/main/res/layout/activity_main.xml (1989 tokens)\n> > app/src/main/res/layout/activity_prefs.xml (2078 tokens)\n> > app/src/main/res/layout/activity_selection.xml (329 tokens)\n> > app/src/main/res/menu/menu_main.xml (320 tokens)\n> > app/src/main/res/mipmap-anydpi-v26/ic_launcher.xml (98 tokens)\n> > app/src/main/res/mipmap-anydpi-v26/ic_launcher_round.xml (98 tokens)\n> > app/src/main/res/values-fr/strings.xml (3981 tokens)\n> > app/src/main/res/values-ja/strings.xml (4781 tokens)\n> > app/src/main/res/values-ko/strings.xml (5981 tokens)\n> > app/src/main/res/values-land/dimens.xml (26 tokens)\n> > app/src/main/res/values-night/themes.xml (318 tokens)\n> > app/src/main/res/values-pl/strings.xml (4453 tokens)\n> > app/src/main/res/values-ru/strings.xml (6457 tokens)\n> > app/src/main/res/values-uk/strings.xml (6475 tokens)\n> > app/src/main/res/values-w1240dp/dimens.xml (26 tokens)\n> > app/src/main/res/values-w600dp/dimens.xml (26 tokens)\n> > app/src/main/res/values-zh/strings.xml (4727 tokens)\n> > app/src/main/res/values/colors.xml (161 tokens)\n> > app/src/main/res/values/dimens.xml (26 tokens)\n> > app/src/main/res/values/strings.xml (3221 tokens)\n> > app/src/main/res/values/themes.xml (454 tokens)\n> > app/src/main/res/xml/backup_rules.xml (160 tokens)\n> > app/src/main/res/xml/data_extraction_rules.xml (221 tokens)\n> > app/src/main/resources/META-INF/MANIFEST.MF (205 tokens)\n> > app/mgrs/src/main/res/values/strings.xml (8 tokens)\n> > app/src/androidTest/java/com/openathena/ExampleInstrumentedTest.java (248 tokens)\n> > app/src/main/java/com/openathena/AboutActivity.java (3054 tokens)\n> > app/src/main/java/com/openathena/ActivityLog.java (2599 tokens)\n> > app/src/main/java/com/openathena/AthenaActivity.java (6517 tokens)\n> > app/src/main/java/com/openathena/AthenaApp.java (1459 tokens)\n> > app/src/main/java/com/openathena/CK42_Gauss_Kr\u00fcger_Translator.java (2137 tokens)\n> > app/src/main/java/com/openathena/CoordTranslator.java (778 tokens)\n> > app/src/main/java/com/openathena/CursorOnTargetSender.java (4168 tokens)\n> > app/src/main/java/com/openathena/DEMParser.java (13895 tokens)\n> > app/src/main/java/com/openathena/DTEDParser.java (632 tokens)\n> > app/src/main/java/com/openathena/DroneParameterProvider.java (67 tokens)\n> > app/src/main/java/com/openathena/DroneParametersFromJSON.java (951 tokens)\n> > app/src/main/java/com/openathena/EGM96OffsetAdapter.java (374 tokens)\n> > app/src/main/java/com/openathena/EGMOffsetProvider.java (44 tokens)\n> > app/src/main/java/com/openathena/MainActivity.java (19266 tokens)\n> > app/src/main/java/com/openathena/MarkableImageView.java (4048 tokens)\n> > app/src/main/java/com/openathena/MetadataExtractor.java (14859 tokens)\n> > app/src/main/java/com/openathena/MissingDataException.java (249 tokens)\n> > app/src/main/java/com/openathena/PrefsActivity.java (2144 tokens)\n> > app/src/main/java/com/openathena/RequestedValueOOBException.java (326 tokens)\n> > app/src/main/java/com/openathena/SelectionActivity.java (2346 tokens)\n> > app/src/main/java/com/openathena/TargetGetter.java (6617 tokens)\n> > app/src/main/java/com/openathena/WGS84_CK42_Geodetic_Translator.java (3211 tokens)\n> > app/src/main/java/com/openathena/geodataAxisParams.java (110 tokens)\n> > app/src/main/java/org/slf4j/ILoggerFactory.java (735 tokens)\n> > app/src/main/java/org/slf4j/IMarkerFactory.java (940 tokens)\n> > app/src/main/java/org/slf4j/Logger.java (8492 tokens)\n> > app/src/main/java/org/slf4j/LoggerFactory.java (7159 tokens)\n> > app/src/main/java/org/slf4j/LoggerFactoryFriend.java (280 tokens)\n> > app/src/main/java/org/slf4j/MDC.java (3347 tokens)\n> > app/src/main/java/org/slf4j/Marker.java (1541 tokens)\n> > app/src/main/java/org/slf4j/MarkerFactory.java (1164 tokens)\n> > app/src/main/java/org/slf4j/package.html (91 tokens)\n> > app/src/main/resources/META-INF/proguard/org.threeten.bp.pro (24 tokens)\n> > app/src/main/resources/META-INF/services/org.threeten.bp.zone.ZoneRulesProvider (17 tokens)\n> > app/src/test/java/com/openathena/ExampleUnitTest.java (130 tokens)\n> > app/src/test/java/org/slf4j/BasicMarkerTest.java (2875 tokens)\n> > app/src/test/java/org/slf4j/Differentiator.java (442 tokens)\n> > app/src/test/java/org/slf4j/DoubleCheckedInt.java (2150 tokens)\n> > app/src/test/java/org/slf4j/LoggerAccessingThread.java (845 tokens)\n> > app/src/test/java/org/slf4j/NoBindingTest.java (684 tokens)\n> > app/src/main/java/com/adobe/xmp/XMPConst.java (2660 tokens)\n> > app/src/main/java/com/adobe/xmp/XMPDateTime.java (1171 tokens)\n> > app/src/main/java/com/adobe/xmp/XMPDateTimeFactory.java (1769 tokens)\n> > app/src/main/java/com/adobe/xmp/XMPError.java (292 tokens)\n> > app/src/main/java/com/adobe/xmp/XMPException.java (363 tokens)\n> > app/src/main/java/com/adobe/xmp/XMPIterator.java (954 tokens)\n> > app/src/main/java/com/adobe/xmp/XMPMeta.java (15441 tokens)\n> > app/src/main/java/com/adobe/xmp/XMPMetaFactory.java (3149 tokens)\n> > app/src/main/java/com/adobe/xmp/XMPPathFactory.java (3761 tokens)\n> > app/src/main/java/com/adobe/xmp/XMPSchemaRegistry.java (1806 tokens)\n> > app/src/main/java/com/adobe/xmp/XMPUtils.java (6110 tokens)\n> > app/src/main/java/com/adobe/xmp/XMPVersionInfo.java (342 tokens)\n> > app/src/main/java/com/adobe/xmp/package.html (152 tokens)\n> > app/src/main/java/com/agilesrc/dem4j/BoundingBox.java (1605 tokens)```\n> > \n> > Should we take a look at any files? If so, pick only a few files (max 5000 tokens). \n> > Respond with a very short rationale, and a list of files.\n> > If looking at files would be a waste of time with regard to the issue, respond with an empty list.\n> > ~~~\n> > \n> > </details>\n> </details>\n</details>\n\n\u26a0\ufe0f\u26a0\ufe0f\u26a0\ufe0f Your OpenAI API key does not have access to the `gpt-4` model. Please note that ChatGPT Plus does not give you access to the `gpt-4` API; you need to sign up on [the GPT-4 API waitlist](https://openai.com/waitlist/gpt-4-api). \n\n<details>\n<summary>Error</summary>\n\n~~~python\nTraceback (most recent call last):\n  File \"/app/autopr/services/action_service.py\", line 186, in run_action\n    results = action.run(arguments, context)\n  File \"/app/autopr/actions/look_at_files.py\", line 375, in run\n    filepaths = self.get_initial_filepaths(files, context)\n  File \"/app/autopr/actions/look_at_files.py\", line 276, in get_initial_filepaths\n    response = self.rail_service.run_prompt_rail(\n  File \"/app/autopr/services/rail_service.py\", line 355, in run_prompt_rail\n    prompt = self.completions_repo.complete(\n  File \"/app/autopr/repos/completions_repo.py\", line 84, in complete\n    raise e\n  File \"/app/autopr/repos/completions_repo.py\", line 65, in complete\n    result = self._complete(\n  File \"/venv/lib/python3.9/site-packages/tenacity/__init__.py\", line 289, in wrapped_f\n    return self(f, *args, **kw)\n  File \"/venv/lib/python3.9/site-packages/tenacity/__init__.py\", line 379, in __call__\n    do = self.iter(retry_state=retry_state)\n  File \"/venv/lib/python3.9/site-packages/tenacity/__init__.py\", line 314, in iter\n    return fut.result()\n  File \"/usr/local/lib/python3.9/concurrent/futures/_base.py\", line 439, in result\n    return self.__get_result()\n  File \"/usr/local/lib/python3.9/concurrent/futures/_base.py\", line 391, in __get_result\n    raise self._exception\n  File \"/venv/lib/python3.9/site-packages/tenacity/__init__.py\", line 382, in __call__\n    result = fn(*args, **kwargs)\n  File \"/app/autopr/repos/completions_repo.py\", line 142, in _complete\n    openai_response = openai.ChatCompletion.create(\n  File \"/venv/lib/python3.9/site-packages/openai/api_resources/chat_completion.py\", line 25, in create\n    return super().create(*args, **kwargs)\n  File \"/venv/lib/python3.9/site-packages/openai/api_resources/abstract/engine_api_resource.py\", line 153, in create\n    response, _, api_key = requestor.request(\n  File \"/venv/lib/python3.9/site-packages/openai/api_requestor.py\", line 230, in request\n    resp, got_stream = self._interpret_response(result, stream)\n  File \"/venv/lib/python3.9/site-packages/openai/api_requestor.py\", line 624, in _interpret_response\n    self._interpret_response_line(\n  File \"/venv/lib/python3.9/site-packages/openai/api_requestor.py\", line 687, in _interpret_response_line\n    raise self.handle_error_response(\nopenai.error.InvalidRequestError: The model `gpt-4` does not exist or you do not have access to it. Learn more: https://help.openai.com/en/articles/7102672-how-can-i-access-gpt-4.\n\n~~~\n\n</details>",
                        "comments": {
                            "nodes": [
                                {
                                    "createdAt": "2023-07-23T17:34:29Z",
                                    "bodyText": "Thank you for your submission! We really appreciate it. Like many open source projects, we ask that you sign our Contributor License Agreement before we can accept your contribution.AutoPR seems not to be a GitHub user. You need a GitHub account to be able to sign the CLA. If you have already a GitHub account, please add the email address used for this commit to your account.You have signed the CLA already but the status is still pending? Let us recheck it.",
                                    "url": "https://github.com/Theta-Limited/OpenAthenaAndroid/pull/82#issuecomment-1646899840",
                                    "author": {
                                        "login": "CLAassistant"
                                    }
                                }
                            ]
                        },
                        "reviews": {
                            "edges": []
                        }
                    },
                    "textMatches": [
                        {
                            "property": "body"
                        }
                    ]
                }
            ],
            "pageInfo": {
                "endCursor": "Y3Vyc29yOjQ=",
                "hasNextPage": false,
                "hasPreviousPage": false,
                "startCursor": "Y3Vyc29yOjE="
            },
            "issueCount": 4
        }
    }
}